# Closed-loop, multichannel experimentation using the open-source NeuroRighter electrophysiology platform

- 神经网络有哪些变量用于控制，评估因果关系
- 到底什么是受控的实验变量
- 刺激尾迹是个什么东西
- 局部场电位 LFP ，脑电图 EEG
- clock synchronization, and trigger synchronization
- 如何定义双向通信
- 细胞外记录，细胞内记录
- 充电宝 + 拓展坞
- 18.5
- 互相关
- 同异突触可塑性
- 可塑性观点的限制
- LTP和LTD究竟是如何界定的，这个指标是如何利用的



# Spatio-temporal electrical stimuli shapebehavior of an embodied cortical network in a goal-directed learning task

> 空间-时间电刺激在目标导向学习任务中塑造具体化大脑皮层网络的行为

- 研究的主要目标是探索一个体外新皮质网络如何通过电刺激的反馈训练来学习调节其动态，并实现用户定义的活动状态。
- 这项研究不仅强调了人工大脑刺激的潜在治疗作用，而且还提供了关于学习和记忆过程如何在网络活动中被表达和诱导的见解。
- 我们将其设置为MEA的中心（图1(a)）。包含空间信息被发现比单独使用发放率更可靠地量化网络功能可塑性（Chao et al 2007）







# CLOSING THE LOOP: STIMULATION FEEDBACK SYSTEMS FOR EMBODIED MEA CULTURES

> MEA 神经网络的刺激反馈系统

**目标：**

我们希望将体外网络的研究与神经系统的自然功能更紧密结合，即连续接收感觉信息、处理信息并连续表达适应性行为。

这种新的体现培养网络的方法将帮助我们和其他研究人员解决一些问题，例如：**活动如何塑造网络的发展**，**神经调节系统如何影响网络连接**，**以及感觉处理、记忆形成和行为控制的分布式神经活动的基础是什么**

**优势：**

在体外研究神经系统相比于体内方法有许多优势。体外系统比完整动物更易于显微成像和药理学操作。



我们的实施例或神经控制动画要么是计算机上的模拟生物（DeMarse 等人，2001），要么是实际的机器人（Bakkum 等人，2004）。  MEA 文化加上具体化的整个系统我们称之为“hybrot”，因为它是一个同时具有活体和人造组件的混合机器人。

**细胞坏死原因：**

一个常见但不太明显的原因：**渗透压的变化。** 培养箱中的潮湿环境应防止细胞培养基蒸发。 然而，除非培养箱门从未打开，否则内部的平均湿度远低于 100%。 在繁忙的实验室中，培养箱经常打开，它可能在 80% 的范围内，并且培养物会因蒸发而遭受高渗透压。 **通过仅用新鲜培养基替换一半培养基来喂养神经培养物的传统使这个问题变得更糟。** 即使在喂食后，高渗透压仍持续存在。 这会导致神经元逐渐恶化和死亡，这通常被认为对于神经培养物来说是“正常”的，因为通常不检查培养基渗透压。

**闭环相关：**

但“在线”不一定是“实时”，尽管这两个术语经常互换使用。 我们所说的“实时”是指在**几毫秒内**即可获得结果的系统，并且最大延迟是已知的并得到保证。

多电极阵列能够在短时间内产生大量数据； 以 25 kHz 对 60 个通道中的每个通道进行采样，可创建每秒几兆字节的数据流，或者一下午数十千兆字节的数据流。 即使磁盘存储成本大幅下降，当前最大的经济实惠的存储系统也会因连续数天的记录而承受沉重负担。 **显然，一些数据缩减策略是必要的，这通常采取从原始数据流中提取尖峰的形式**。

然而，作者在实验中**没有观察到**任何持久的行为变化。这意味着尽管进行了闭环刺激，仿生体的行为（由自发活动驱动的开环行为）在30分钟后并没有显示出明显的、持续的改变。

在Shahaf和Marom的研究中，他们采用了一种不同的闭环策略。他们在培养的皮层网络上施加刺激，**直到网络显示出一定的学习标准**——在给定探针刺激后的50±10毫秒内显著增加射频。这种策略是基于“学习”定义为对特定刺激的响应增强的假设。

他们的闭环系统的一个关键特点是，一旦达到了学习标准，就会**关闭周期性刺激**。这种刺激的关闭被假设为网络“选择”了最近的活动模式作为适应性或期望的反应。换句话说，**网络通过这种方式“记住”了在实现学习标准时的活动状态**。

**这表明闭环反馈的设计和实现方式对研究结果有重要影响。**



**spike 检测算法：**

大多数 MEA 用户认为小于动作电位的神经信号（例如突触后电位）隐藏在细胞外记录的噪声中，因此只有记录动作电位才有意义。 这并不完全正确。 我们观察到，从活体培养物中记录时的“噪音”水平高于从仅含有培养基的干净 MEA 中进行记录时的“噪音”水平。 通过用河豚毒素阻断 MEA 培养物中所有钠通道依赖性活性，**我们证实，许多通常被称为“噪声”的微小电压峰实际上是生物源性的，并且可能包括阈下去极化以及从神经元记录的尖峰距电极一定距离。** 此练习有助于设置用于检测动作电位的适当阈值，该阈值通常为背景信号标准偏差的四到六倍，具体取决于我们希望包含或排除可疑峰值。

**尖峰检测阈值可能会在实验过程中发生变化，尤其是长时间的实验，其中神经元和电极之间的物理关系由于细胞生长而发生变化。** MeaBench 有一个模块，可以自适应调整尖峰检测阈值

**闭环平台应该具有的功能：**

• 实时伪影抑制

 • 实时尖峰检测，具有易于更换的检测算法 

• 以任意速度回放原始电极迹线和记录的尖峰





**闭环刺激参数相关：**

第 1 节中提到的小组已使用多种脉冲形状通过 MEA 电极激发神经元活动，包括电压控制和电流控制脉冲。 人们如何决定使用哪种刺激？ 我们系统地研究了两种类型刺激的功效作为幅度和脉冲宽度的函数（Wagenaar 等，2004）。 **我们发现，在大多数情况下，负电流脉冲会刺激神经元激发动作电位。 这并不意味着压控脉冲没有用处。 事实上，正向第一双相电压控制脉冲是我们的所有刺激中最有效的刺激。 如果人们认识到两相之间急剧下降的电压瞬变对应于强负电流脉冲，则这一点很容易理解。**

1. **研究发现：**
   - **负电流脉冲：** 在大多数情况下，负电流脉冲最能激发神经元产生动作电位。
   - **正向先导的双相电压**控制脉冲：
     - 双相电压控制脉冲包括一个正相和一个负相。
     - **研究发现，正向先导的双相电压控制脉冲是最有效的刺激类型。**
     - **这主要因为在两个相位之间急剧下降的电压瞬变实际上对应着一个强烈的负电流脉冲，从而能够有效激发神经元活动。**
2. **1. 基本概念：**
   - **电压控制脉冲（Voltage-Controlled Pulse）：**
     - 在这种脉冲类型中，电极上施加的电压由预先设定的波形控制。
     - 电压的变化波形通常是单相或双相。
     - **单相脉冲：** 电压在一个方向上施加，如仅正电压或仅负电压。
     - **双相脉冲：** 电压在两个方向上交替施加，如先正电压、再负电压。
   - **电流控制脉冲（Current-Controlled Pulse）：**
     - 在这种脉冲类型中，电极上施加的电流由预先设定的波形控制。
     - 通常以负电流脉冲为主，即电流方向是从神经元流向电极。
     - **单相脉冲：** 电流在一个方向上施加，如仅负电流。
     - **双相脉冲：** 电流在两个方向上交替施加，如先正电流、再负电流。



研究人员传统上更喜欢电流控制的刺激，因为它们的功效似乎更适合建模（Buitenweg 等人，2002），因为刺激产生的电场和电位与通过电极的电流成正比。 然而，使用电压控制有显着的优点：不仅控制电压所需的电路更简单，而且更重要的是，**通过电压控制可以避免电化学反应。 电流控制的刺激很容易超过电压，从而损坏电极并伤害神经元；** 当电极电压超过一伏时，这一点变得很重要。 虽然可以通过采用电荷平衡脉冲来减少损坏，但仍然希望完全避免它。 在电流控制下，只有当阵列中所有电极的阻抗谱已知时，这才有可能。 此外，电流控制的关键优势（计算电极周围介质中产生的电场的能力）在 MEA 中受到损害，因为通过绝缘层的漏电流会使实际流经电极的电流减少多达 30% 取决于绝缘层的完整性和厚度。 **因此，我们使用小于 1 伏的电压控制正先双相脉冲。**



**脉冲幅度是刺激功效的主要决定因素**（Wagenaar 等，2004）。 受给定电压控制脉冲直接刺激的细胞数量随着该脉冲的幅度线性增长。 培养网络对电压脉冲的宽度不那么敏感。 **当然，脉冲必须足够宽，以允许细胞膜和系统中的所有寄生电容有时间充电**，在**我们的系统中大约为 400 微秒。 将宽度增加到超过 400 微秒对神经反应几乎没有影响。**



到目前为止，商业刺激系统仅限于少量电极**（通常少于10个）**，并且需要提前完全指定刺激协议



**刺激尾迹：**

任何使用 MEA 电极进行刺激和记录的人都知道这两者很难结合起来。 **多电极阵列通常记录 10-100 µV 的信号，而刺激约为 1 V。 这两个电压范围之间的巨大差异意味着刺激产生的伪影很容易淹没记录的动作电位，即使在远离刺激部位的电极上也是如此。**

我们经常观察到**持续数十毫秒、振幅达数百微伏的跨通道刺激伪影**。由于许多神经元在这一时期内对刺激作出反应，因此能够在刺激后立即记录非常重要，因此抑制伪影至关重要。



1. **伪影的来源：**
   - 电容串扰：
     - 电极导线之间的电容耦合导致电流从刺激电极传导到其他记录电极。
   - 培养基中的导电：
     - 刺激电极中的电流通过培养基导电，耦合到其他记录电极。
2. **伪影的放大：**
   - 动态范围的限制：
     - 如果伪影信号的振幅超过放大器的动态范围，放大器就会饱和。
   - 非线性特性：
     - 饱和的放大器具有非线性特性，连接的滤波器也会增加伪影的持续时间和振幅。
3. **伪影的影响：**
   - 跨通道伪影：
     - 刺激伪影会影响到多个记录电极，产生振幅达数百微伏、持续数十毫秒的伪影信号。
   - 神经元响应：
     - 由于许多神经元在这一时间范围内对刺激作出反应，伪影会干扰对真实神经元响应的记录。
4. **伪影抑制的重要性：**
   - 及时记录：
     - 伪影抑制至关重要，因为能够在刺激后立即记录真实的神经元响应对实验至关重要。





**文献引用相关：**

这是一个神经行为学实验，因为我们没有为仿生体设置任何特定的任务，**而是仅仅观察了反馈刺激对其行为的影响**。我们使用**人工神经网络在高维空间中聚类射频率数据**，**并分类重现的模式**（DeMarse 等人，2001）。我们发现，培养的皮层网络表达的活动模式的多样性通过实时反馈刺激得到了增强，至少在感觉-运动回路闭合时是这样。



**创新点，与成像技术结合，实时观测数天细胞状态：**

通过将 MEA 与显微成像结合使用，现在可以在各种时间尺度上观察活动依赖性形态动力学的发生。 波特与加州理工学院生物成像中心的斯科特·弗雷泽一起开发了新的成像技术，可以将哺乳动物神经元维持在显微镜阶段数天，从而可以拍摄形态动态的延时电影。 其中包括 2 光子显微镜和样本生命支持方面的进步（Potter，2000；Potter 等人，1996a；Potter 等人，2001a；Potter 等人，1996b；Potter 等人，1996c；Potter 等人。  ，2001b)。



**刺激会有不应期：**

。在控制中，Alec Shkolnik使用了一种可重复的网络属性，即对两次刺激脉冲的第二次的反应强度的增强或减弱，这取决于两次刺激间的间隔（IPI）。在短IPI（±20毫秒）时，响应是最大的，大约是单独给予每次刺激时反应的总和。但在100-300毫秒的IPI时，**网络仍处于第一次刺激后的不应期**，反应是最小的（Darbon等人，2002）。超过500毫秒后，反应是中等的。Koala在一个反馈周期内的移动幅度与这种反应成比例。目标距离被编码在随后的IPI中。这种映射使Koala能够接近一个静止的机器人，并在它开始移动时保持一定的距离跟随。在欧洲，作为多国欧盟资助的NeuroBIT项目的一部分，正在进行其他闭环hybrot实验，使用培养的网络（Martinoia等人，（2004））。

**可以具体看一下他们如何实现的对距离的编码.**







# Relationship between autonomous and evoked activities in a living neuronal network of a neurorobot,”Vitaenoid”.

> 神经机器人“Vitaenoid”的活神经元网络中自主活动和诱发活动之间的关系。

- **背景和重要性**：

  - 神经假体的发展需要理解神经回路的输入输出关系，特别是网络动态的基本特性。为此，需要一个模型系统，用于活体神经回路和电气设备之间的双向通信。

- **神经机器人作为模型系统**：

  - 神经机器人结合了生物有机体和机器人框架，配备了在多电极阵列上培养的活体神经回路（LNC）和移动机器人身体或机械臂。多电极阵列用于测量神经网络活动并对其进行电刺激。
  - 神经机器人被用作研究生物组件的体现（embodiment）概念的实验模型。

- #### 1. 系统组成

  - **主要组件**：Vitaenoid系统的主要组成部分包括活体神经回路（LNC）、机器人身体和多点细胞外电位记录系统。
  - **LNC准备**：使用从18天胚胎大鼠海马神经元制备的LNC，利用常规培养技术进行培养。
  - **电活动记录**：通过MED64系统记录神经元的电活动，并可以施加电刺激以引发动作电位。

- #### 2. 软件控制

  - **Vitaenoid软件**：由脑接口（BI）和SOM客户端（SOMC）组成，通过TCP-IP协议通信，使用LabVIEW开发。
  - **基本概念**：LNC是系统的中心处理组件，无需其他监督者。通过设计LNC与机器人身体之间的连接算法（SOM），实现理想行为。

- 

- “Vitaenoid”的主要组成部分是一个活体神经回路（LNC）、一个机器人身体和一个作为LNC与电气组件之间接口的多点细胞外电位记录系统。

- LNC采用常规培养技术制备。从18天胚胎（E18）的Wistar大鼠（Jcl:Wistar, CLEA Japan, Japan）的海马神经元中制备，并使用改良的先前描述的方法进行培养。神经电活动通过多点细胞外电位记录系统（MED64系统，Alpha MED科学，日本）测量。该系统还允许我们对神经元施加电流刺激，以在刺激电极上引发动作电位。MED64系统由我们实验室使用LabVIEW（National Instruments，日本）开发的“Vitaenoid软件”控制。接口程序由两个独立的程序组成，即脑接口（BI）和SOM客户端（SOMC），这些软件通过TCP-IP协议相互通信

- 我们设计了LNC与机器人身体之间的连接算法（本研究中的SOM），以实现理想的行为，而不是明确地训练LNC以执行理想的反应。神经活动模式被翻译成时间快照的特征向量。定义为峰值超过适当阈值的尖峰在特定时间窗口内被计数（本研究中时间窗口的宽度设置为100毫秒）。在某个时间窗口内某个电极上的电尖峰构成特征向量的一个元素（图2c）。

- 在本研究中，机器人的任务是避障。为了实现平滑的避障行为，LNC和“Vitaenoid软件”必须至少区分三种情况：左侧有障碍物、右侧有障碍物和没有障碍物。我们已经确认，通过特定刺激，即使单个LNC也能引发两种不同的时空模式。因此，选择两个不同的电极分别对应左侧障碍和右侧障碍情境。实验选择这些电极以增加这些两个电极引发的活动模式之间的差异。

  > - 选择两个不同的电极来对应两种具体情境（左侧障碍和右侧障碍），目的是为了确保这两种情境下引发的神经活动模式具有明显的差异，从而使系统能够有效地区分这两种情境。

- 在本研究中，机器人身体（e-puck，cyberbotics，瑞士）配备了8个红外传感器，机器人前方左侧和右侧各两个传感器用于检测障碍物。当左侧或右侧障碍物的传感器值之和超过另一侧的传感器值之和并超过某个阈值时，“Vitaenoid软件”决定通过分配给具有较大和的电极来刺激LNC（图4a）。





- 特定刺激引发的时空模式包含一些波动。为了解码这种与外部物体相关的波动神经活动模式，考虑了各种策略。在“SOM-Vitaenoid”中，采用了稍作修改的SOM算法，将64维神经活动映射到二维特征空间，因为该算法可用于映射，避免严格分类。机器人的行为根据SOM输出层赢家节点的位置决定，该位置对应于当时活动模式的快照（图4b）。根据输出层赢家节点的位置，确定一组电机速度，每秒生成一次行为。



#### 1. 机器人行为决定

- **赢家节点位置**：机器人的行为根据SOM输出层赢家节点的位置决定。赢家节点对应于当时活动模式的快照。
- **行为生成频率**：每秒生成一次行为，根据赢家节点的位置确定一组电机速度。

#### 2. SOM构建

- **特征向量输入**：64维的神经活动特征向量持续输入到SOM中，特征向量对应尖峰模式的时间快照。
- **输出层**：SOM输出层为30 × 30的二维网格，每个节点有一个64维的参考向量。
- **赢家节点选择**：计算输入特征向量与每个节点参考向量之间的欧氏距离，选择距离最小的节点作为赢家节点。
- **参考向量更新**：使用学习系数更新赢家节点和邻居节点的参考向量，使其更接近输入特征向量。

#### 3. 参考向量初始设置

- **区域划分**：输出层被分为三个区域，分别对应L侧障碍、R侧障碍和自发活动。
- **初始参考向量**：通过电刺激反复施加，分配特征向量作为输出层节点的初始参考向量。
- **种子程序**：选择特定节点作为种子节点，通过种子程序强制这些节点成为赢家节点，并更新邻居节点的参考向量。

#### 4. 机器人行为生成

- **SOM算法**：SOM算法将相似尖峰模式的节点放置在邻居中，输出层中节点之间的相对空间关系对应输入向量之间的相似性。
- **电机速度计算**：根据赢家节点相对于种子节点的位置计算电机速度，机器人行为根据电机速度调整来实现避障。



- 我们让“SOM-Vitaenoid”在两个平行排列的墙壁之间的场地内自由运行。墙壁之间的距离为150毫米，场地的纵向长度为1200毫米。实验使用了从胚胎第18天和体外培养第20到70天（E18DIV20-70）的LNC。机器人运行前，分别对L-和R-输入进行了40次种子程序，每次试验的运行时间为60分钟。在6次60分钟的运行过程中，机器人几乎都成功避免了与墙壁的碰撞，但有时在与墙壁碰撞后会改变方向。
- 在种子程序之后，对应特定情况的节点分布在指定区域内，但在机器人运行过程中，这种分布发生了显著变化。尤其是自发活动的赢家节点分布在整个输出层，并与L-和R-障碍情况共享节点。这表明在机器人运行过程中，神经网络的活动模式具有高度的动态性和可塑性。
- 在6次实验中，自发活动和诱发活动共享赢家节点的比例在初始0-10分钟期间较高，但在50-60分钟期间显著减少。这种变化趋势表明，随着时间的推移，神经网络对特定输入的响应变得更加准确。然而，由于共享比例在不同LNCs之间变化较大，这些变化在统计上不显著。



机器人的行为是自主的，有时会以意想不到的方式移动，这是由自发活动贡献的。然而，机器人几乎总是能够进行适当的避障。在机器人运行期间，活动的时空模式发生显著变化。自发活动和诱发活动共享的赢家节点更不稳定，表明了自发活动的灵活性和可塑性。诱发活动和自发活动之间的赢家节点的共享比例减少，有助于提高对特定输入的活动响应的准确性和可重复性。这表明在机器人运行期间，**某种类型的自主学习过程正在进行。**

研究发现，诱发活动和自发活动之间共享相似的时空电活动模式。共享活动模式的平均比例高达约20%，表明自发活动不仅是噪音，而且与诱发活动共享共同机制。我们提出“神经回路输入输出关系的松散耦合假说”，即神经回路的输入和输出不是紧密耦合的，而是松散耦合的，即输入增加了从各种活动模式池中（作为自发活动表达）出现特定活动模式（与输入相关）的概率。



传统观点认为，神经回路的输入和输出之间是紧密耦合的，即特定的输入会直接导致特定的输出。然而，研究表明，自发活动和诱发活动之间存在复杂的相互作用，输入和输出的关系并非完全线性和确定性的。

研究发现，诱发活动和自发活动之间共享相似的时空电活动模式。共享活动模式的平均比例高达约20%，表明自发活动不仅是噪音，而且与诱发活动共享共同机制。我们提出“神经回路输入输出关系的松散耦合假说”，即神经回路的输入和输出不是紧密耦合的，而是松散耦合的，即输入增加了从各种活动模式池中（作为自发活动表达）出现特定活动模式（与输入相关）的概率。

这意味着输入信号不会直接决定输出行为，而是通过影响神经回路中各种活动模式的概率来间接决定输出



**自发活动和诱发活动的关系**

自发活动：在没有外界刺激的情况下，神经回路会产生自发的电活动。这些自发活动具有高度的可变性和复杂性。

诱发活动：在外界刺激下，神经回路会产生诱发的电活动模式。尽管这些模式相对稳定，但也会受到自发活动的影响。

研究发现，自发活动和诱发活动之间共享相似的时空电活动模式，这表明自发活动不仅仅是噪音，而是与诱发活动共享共同的机制。

松散耦合假说认为，输入信号并不会直接导致特定的输出行为，而是通过增加神经回路中某些特定活动模式出现的概率来间接影响输出。输入信号的作用是“引导”神经回路从自发活动中选择特定的活动模式，而不是直接“指挥”输出行为。

 



# Brain-Controlled 2D Navigation Robot Based on a Spatial Gradient Controller and Predictive Environmental Coordinator

这项研究提出了一种新形式的脑机共享控制策略，以二维控制向量流而不是选择性常数值的形式量化大脑命令。 结合预测环境协调器，优化了机器人的脑控策略，并提供了更高的灵活性。 所提出的控制器可用于脑控二维导航设备，例如脑控轮椅和车辆。

一开始的控制方法咋啦？这个怎么改进了？

Spatial Gradient Paradigm 到底是个啥？

机器人基本是如何驱动的？



#### 实验设置

- **控制条设计**：控制条上的小条以不同频率闪烁，频率范围从7.2 Hz到9.0 Hz。受试者注视不同位置产生不同的EEG信号。
- **数据处理**：EEG信号通过空间梯度控制器转换为二维向量，再通过预测环境协调器结合环境信息调整机器人运动。

多障碍物躲避任务，即受试者需要控制机器人使其绕过左侧或右侧的障碍物。 控制机器人在真实环境中跨越多个障碍物，在120秒内到达目标区域。每个任务由3种方法执行。 1）时间离散控制基于[23]，通过3次刺激，机器人以3种模式（向前移动、左旋转和右旋转）移动，命令由2个离散时间窗口生成，这意味着机器人每2秒改变一次移动状态。 2）滑动时间控制基于[12]，机器人以类似的模式移动（向前移动、左转和右转），但大脑命令是由2 s的滑动时间窗口生成的。 这意味着机器人可以随时改变其状态。 离散控制和滑动时间控制的共享范式如图 6 所示。所提出的 SGC+PEC 方法如图 3 所示。对于每个受试者，收集机器人的里程表数据、机器人的路径长度和平均速度 计算，并评估控制稳定性。 对于每个受试者，每个任务重复 3-6 次，直到有 3 次成功执行任务。